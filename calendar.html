<html>
  <head>
    <title>Calendar Heatmap</title>
    <style>
      .body {
        height: 97%;
      }

      svg {
        height: 1800;
        width: 97%;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.9.2/d3.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-color/1.2.1/d3-color.js"></script>
  </head>
    <body>
    <h3>Calendar Heatmap</h3>
    <h4>Daily Number of Crime Events</h4>
    <svg id="svg"></svg>
    <script>
      const sample = [
        // {
        //   "Date": "2015-01-01",
        //   "Count": "82"
        // },
        {
          "Date": "2015-01-02",
          "Count": "113"
        },
        {
          "Date": "2015-01-03",
          "Count": "93"
        },
        {
          "Date": "2015-01-04",
          "Count": "81"
        },
        {
          "Date": "2015-01-05",
          "Count": "125"
        },
        {
          "Date": "2015-01-06",
          "Count": "136"
        },
        {
          "Date": "2015-01-07",
          "Count": "100"
        },
        {
          "Date": "2015-01-08",
          "Count": "90"
        },
        {
          "Date": "2015-01-09",
          "Count": "97"
        },
        {
          "Date": "2015-01-10",
          "Count": "80"
        },
        {
          "Date": "2015-01-11",
          "Count": "66"
        },
        {
          "Date": "2015-01-12",
          "Count": "136"
        },
        {
          "Date": "2015-01-13",
          "Count": "109"
        },
        {
          "Date": "2015-01-14",
          "Count": "143"
        },
        {
          "Date": "2015-01-15",
          "Count": "100"
        },
        {
          "Date": "2015-01-16",
          "Count": "105"
        },
        {
          "Date": "2015-01-17",
          "Count": "67"
        },
        {
          "Date": "2015-01-18",
          "Count": "78"
        },
        {
          "Date": "2015-01-19",
          "Count": "91"
        },
        {
          "Date": "2015-01-20",
          "Count": "103"
        },
        {
          "Date": "2015-01-21",
          "Count": "103"
        },
        {
          "Date": "2015-01-22",
          "Count": "88"
        },
        {
          "Date": "2015-01-23",
          "Count": "108"
        },
        {
          "Date": "2015-01-24",
          "Count": "66"
        },
        {
          "Date": "2015-01-25",
          "Count": "84"
        },
        {
          "Date": "2015-01-26",
          "Count": "91"
        },
        {
          "Date": "2015-01-27",
          "Count": "103"
        },
        {
          "Date": "2015-01-28",
          "Count": "114"
        },
        {
          "Date": "2015-01-29",
          "Count": "116"
        },
        {
          "Date": "2015-01-30",
          "Count": "118"
        },
        {
          "Date": "2015-01-31",
          "Count": "81"
        },
        {
          "Date": "2015-02-01",
          "Count": "100"
        },
        {
          "Date": "2015-02-02",
          "Count": "151"
        },
        {
          "Date": "2015-02-03",
          "Count": "131"
        },
        {
          "Date": "2015-02-04",
          "Count": "120"
        },
        {
          "Date": "2015-02-05",
          "Count": "119"
        },
        {
          "Date": "2015-02-06",
          "Count": "104"
        },
        {
          "Date": "2015-02-07",
          "Count": "85"
        },
        {
          "Date": "2015-02-08",
          "Count": "85"
        },
        {
          "Date": "2015-02-09",
          "Count": "109"
        },
        {
          "Date": "2015-02-10",
          "Count": "98"
        },
        {
          "Date": "2015-02-11",
          "Count": "95"
        },
        {
          "Date": "2015-02-12",
          "Count": "121"
        },
        {
          "Date": "2015-02-13",
          "Count": "101"
        },
        {
          "Date": "2015-02-14",
          "Count": "95"
        },
        {
          "Date": "2015-02-15",
          "Count": "82"
        },
        {
          "Date": "2015-02-16",
          "Count": "117"
        },
        {
          "Date": "2015-02-17",
          "Count": "128"
        },
        {
          "Date": "2015-02-18",
          "Count": "114"
        },
        {
          "Date": "2015-02-19",
          "Count": "93"
        },
        {
          "Date": "2015-02-20",
          "Count": "111"
        },
        {
          "Date": "2015-02-21",
          "Count": "104"
        },
        {
          "Date": "2015-02-22",
          "Count": "87"
        },
        {
          "Date": "2015-02-23",
          "Count": "112"
        },
        {
          "Date": "2015-02-24",
          "Count": "110"
        },
        {
          "Date": "2015-02-25",
          "Count": "96"
        },
        {
          "Date": "2015-02-26",
          "Count": "94"
        },
        {
          "Date": "2015-02-27",
          "Count": "66"
        },
        {
          "Date": "2015-02-28",
          "Count": "45"
        },
        {
          "Date": "2015-03-01",
          "Count": "90"
        },
        {
          "Date": "2015-03-02",
          "Count": "133"
        },
        {
          "Date": "2015-03-03",
          "Count": "104"
        },
        {
          "Date": "2015-03-04",
          "Count": "122"
        },
        {
          "Date": "2015-03-05",
          "Count": "88"
        },
        {
          "Date": "2015-03-06",
          "Count": "97"
        },
        {
          "Date": "2015-03-07",
          "Count": "98"
        },
        {
          "Date": "2015-03-08",
          "Count": "93"
        },
        {
          "Date": "2015-03-09",
          "Count": "105"
        },
        {
          "Date": "2015-03-10",
          "Count": "97"
        },
        {
          "Date": "2015-03-11",
          "Count": "101"
        },
        {
          "Date": "2015-03-12",
          "Count": "90"
        },
        {
          "Date": "2015-03-13",
          "Count": "101"
        },
        {
          "Date": "2015-03-14",
          "Count": "90"
        },
        {
          "Date": "2015-03-15",
          "Count": "101"
        },
        {
          "Date": "2015-03-16",
          "Count": "120"
        },
        {
          "Date": "2015-03-17",
          "Count": "137"
        },
        {
          "Date": "2015-03-18",
          "Count": "106"
        },
        {
          "Date": "2015-03-19",
          "Count": "106"
        },
        {
          "Date": "2015-03-20",
          "Count": "105"
        },
        {
          "Date": "2015-03-21",
          "Count": "102"
        },
        {
          "Date": "2015-03-22",
          "Count": "103"
        },
        {
          "Date": "2015-03-23",
          "Count": "117"
        },
        {
          "Date": "2015-03-24",
          "Count": "116"
        },
        {
          "Date": "2015-03-25",
          "Count": "84"
        },
        {
          "Date": "2015-03-26",
          "Count": "104"
        },
        {
          "Date": "2015-03-27",
          "Count": "100"
        },
        {
          "Date": "2015-03-28",
          "Count": "97"
        },
        {
          "Date": "2015-03-29",
          "Count": "92"
        },
        {
          "Date": "2015-03-30",
          "Count": "98"
        },
        {
          "Date": "2015-03-31",
          "Count": "106"
        },
        {
          "Date": "2015-04-01",
          "Count": "91"
        },
        {
          "Date": "2015-04-02",
          "Count": "109"
        },
        {
          "Date": "2015-04-03",
          "Count": "110"
        },
        {
          "Date": "2015-04-04",
          "Count": "103"
        },
        {
          "Date": "2015-04-05",
          "Count": "67"
        },
        {
          "Date": "2015-04-06",
          "Count": "92"
        },
        {
          "Date": "2015-04-07",
          "Count": "110"
        },
        {
          "Date": "2015-04-08",
          "Count": "113"
        },
        {
          "Date": "2015-04-09",
          "Count": "80"
        },
        {
          "Date": "2015-04-10",
          "Count": "121"
        },
        {
          "Date": "2015-04-11",
          "Count": "92"
        },
        {
          "Date": "2015-04-12",
          "Count": "111"
        },
        {
          "Date": "2015-04-13",
          "Count": "123"
        },
        {
          "Date": "2015-04-14",
          "Count": "123"
        },
        {
          "Date": "2015-04-15",
          "Count": "110"
        },
        {
          "Date": "2015-04-16",
          "Count": "111"
        },
        {
          "Date": "2015-04-17",
          "Count": "93"
        },
        {
          "Date": "2015-04-18",
          "Count": "86"
        },
        {
          "Date": "2015-04-19",
          "Count": "93"
        },
        {
          "Date": "2015-04-20",
          "Count": "121"
        },
        {
          "Date": "2015-04-21",
          "Count": "111"
        },
        {
          "Date": "2015-04-22",
          "Count": "123"
        },
        {
          "Date": "2015-04-23",
          "Count": "119"
        },
        {
          "Date": "2015-04-24",
          "Count": "125"
        },
        {
          "Date": "2015-04-25",
          "Count": "88"
        },
        {
          "Date": "2015-04-26",
          "Count": "106"
        },
        {
          "Date": "2015-04-27",
          "Count": "126"
        },
        {
          "Date": "2015-04-28",
          "Count": "113"
        },
        {
          "Date": "2015-04-29",
          "Count": "114"
        },
        {
          "Date": "2015-04-30",
          "Count": "106"
        },
        {
          "Date": "2015-05-01",
          "Count": "111"
        },
        {
          "Date": "2015-05-02",
          "Count": "95"
        },
        {
          "Date": "2015-05-03",
          "Count": "88"
        },
        {
          "Date": "2015-05-04",
          "Count": "136"
        },
        {
          "Date": "2015-05-05",
          "Count": "124"
        },
        {
          "Date": "2015-05-06",
          "Count": "134"
        },
        {
          "Date": "2015-05-07",
          "Count": "87"
        },
        {
          "Date": "2015-05-08",
          "Count": "99"
        },
        {
          "Date": "2015-05-09",
          "Count": "98"
        },
        {
          "Date": "2015-05-10",
          "Count": "79"
        },
        {
          "Date": "2015-05-11",
          "Count": "120"
        },
        {
          "Date": "2015-05-12",
          "Count": "117"
        },
        {
          "Date": "2015-05-13",
          "Count": "92"
        },
        {
          "Date": "2015-05-14",
          "Count": "125"
        },
        {
          "Date": "2015-05-15",
          "Count": "126"
        },
        {
          "Date": "2015-05-16",
          "Count": "76"
        },
        {
          "Date": "2015-05-17",
          "Count": "100"
        },
        {
          "Date": "2015-05-18",
          "Count": "148"
        },
        {
          "Date": "2015-05-19",
          "Count": "121"
        },
        {
          "Date": "2015-05-20",
          "Count": "103"
        },
        {
          "Date": "2015-05-21",
          "Count": "123"
        },
        {
          "Date": "2015-05-22",
          "Count": "103"
        },
        {
          "Date": "2015-05-23",
          "Count": "106"
        },
        {
          "Date": "2015-05-24",
          "Count": "79"
        },
        {
          "Date": "2015-05-25",
          "Count": "88"
        },
        {
          "Date": "2015-05-26",
          "Count": "123"
        },
        {
          "Date": "2015-05-27",
          "Count": "113"
        },
        {
          "Date": "2015-05-28",
          "Count": "127"
        },
        {
          "Date": "2015-05-29",
          "Count": "112"
        },
        {
          "Date": "2015-05-30",
          "Count": "97"
        },
        {
          "Date": "2015-05-31",
          "Count": "99"
        },
        {
          "Date": "2015-06-01",
          "Count": "130"
        },
        {
          "Date": "2015-06-02",
          "Count": "114"
        },
        {
          "Date": "2015-06-03",
          "Count": "111"
        },
        {
          "Date": "2015-06-04",
          "Count": "123"
        },
        {
          "Date": "2015-06-05",
          "Count": "100"
        },
        {
          "Date": "2015-06-06",
          "Count": "78"
        },
        {
          "Date": "2015-06-07",
          "Count": "86"
        },
        {
          "Date": "2015-06-08",
          "Count": "122"
        },
        {
          "Date": "2015-06-09",
          "Count": "115"
        },
        {
          "Date": "2015-06-10",
          "Count": "117"
        },
        {
          "Date": "2015-06-11",
          "Count": "128"
        },
        {
          "Date": "2015-06-12",
          "Count": "110"
        },
        {
          "Date": "2015-06-13",
          "Count": "98"
        },
        {
          "Date": "2015-06-14",
          "Count": "75"
        },
        {
          "Date": "2015-06-15",
          "Count": "117"
        },
        {
          "Date": "2015-06-16",
          "Count": "111"
        },
        {
          "Date": "2015-06-17",
          "Count": "103"
        },
        {
          "Date": "2015-06-18",
          "Count": "119"
        },
        {
          "Date": "2015-06-19",
          "Count": "110"
        },
        {
          "Date": "2015-06-20",
          "Count": "77"
        },
        {
          "Date": "2015-06-21",
          "Count": "87"
        },
        {
          "Date": "2015-06-22",
          "Count": "132"
        },
        {
          "Date": "2015-06-23",
          "Count": "117"
        },
        {
          "Date": "2015-06-24",
          "Count": "102"
        },
        {
          "Date": "2015-06-25",
          "Count": "144"
        },
        {
          "Date": "2015-06-26",
          "Count": "106"
        },
        {
          "Date": "2015-06-27",
          "Count": "95"
        },
        {
          "Date": "2015-06-28",
          "Count": "90"
        },
        {
          "Date": "2015-06-29",
          "Count": "126"
        },
        {
          "Date": "2015-06-30",
          "Count": "145"
        },
        {
          "Date": "2015-07-01",
          "Count": "107"
        },
        {
          "Date": "2015-07-02",
          "Count": "125"
        },
        {
          "Date": "2015-07-03",
          "Count": "97"
        },
        {
          "Date": "2015-07-04",
          "Count": "102"
        },
        {
          "Date": "2015-07-05",
          "Count": "85"
        },
        {
          "Date": "2015-07-06",
          "Count": "125"
        },
        {
          "Date": "2015-07-07",
          "Count": "111"
        },
        {
          "Date": "2015-07-08",
          "Count": "116"
        },
        {
          "Date": "2015-07-09",
          "Count": "123"
        },
        {
          "Date": "2015-07-10",
          "Count": "110"
        },
        {
          "Date": "2015-07-11",
          "Count": "80"
        },
        {
          "Date": "2015-07-12",
          "Count": "90"
        },
        {
          "Date": "2015-07-13",
          "Count": "137"
        },
        {
          "Date": "2015-07-14",
          "Count": "134"
        },
        {
          "Date": "2015-07-15",
          "Count": "97"
        },
        {
          "Date": "2015-07-16",
          "Count": "103"
        },
        {
          "Date": "2015-07-17",
          "Count": "108"
        },
        {
          "Date": "2015-07-18",
          "Count": "106"
        },
        {
          "Date": "2015-07-19",
          "Count": "90"
        },
        {
          "Date": "2015-07-20",
          "Count": "101"
        },
        {
          "Date": "2015-07-21",
          "Count": "150"
        },
        {
          "Date": "2015-07-22",
          "Count": "126"
        },
        {
          "Date": "2015-07-23",
          "Count": "124"
        },
        {
          "Date": "2015-07-24",
          "Count": "160"
        },
        {
          "Date": "2015-07-25",
          "Count": "82"
        },
        {
          "Date": "2015-07-26",
          "Count": "104"
        },
        {
          "Date": "2015-07-27",
          "Count": "131"
        },
        {
          "Date": "2015-07-28",
          "Count": "144"
        },
        {
          "Date": "2015-07-29",
          "Count": "120"
        },
        {
          "Date": "2015-07-30",
          "Count": "110"
        },
        {
          "Date": "2015-07-31",
          "Count": "126"
        },
        {
          "Date": "2015-08-01",
          "Count": "92"
        },
        {
          "Date": "2015-08-02",
          "Count": "81"
        },
        {
          "Date": "2015-08-03",
          "Count": "159"
        },
        {
          "Date": "2015-08-04",
          "Count": "107"
        },
        {
          "Date": "2015-08-05",
          "Count": "132"
        },
        {
          "Date": "2015-08-06",
          "Count": "115"
        },
        {
          "Date": "2015-08-07",
          "Count": "134"
        },
        {
          "Date": "2015-08-08",
          "Count": "78"
        },
        {
          "Date": "2015-08-09",
          "Count": "75"
        },
        {
          "Date": "2015-08-10",
          "Count": "126"
        },
        {
          "Date": "2015-08-11",
          "Count": "108"
        },
        {
          "Date": "2015-08-12",
          "Count": "115"
        },
        {
          "Date": "2015-08-13",
          "Count": "107"
        },
        {
          "Date": "2015-08-14",
          "Count": "105"
        },
        {
          "Date": "2015-08-15",
          "Count": "66"
        },
        {
          "Date": "2015-08-16",
          "Count": "94"
        },
        {
          "Date": "2015-08-17",
          "Count": "148"
        },
        {
          "Date": "2015-08-18",
          "Count": "126"
        },
        {
          "Date": "2015-08-19",
          "Count": "132"
        },
        {
          "Date": "2015-08-20",
          "Count": "99"
        },
        {
          "Date": "2015-08-21",
          "Count": "113"
        },
        {
          "Date": "2015-08-22",
          "Count": "90"
        },
        {
          "Date": "2015-08-23",
          "Count": "78"
        },
        {
          "Date": "2015-08-24",
          "Count": "115"
        },
        {
          "Date": "2015-08-25",
          "Count": "115"
        },
        {
          "Date": "2015-08-26",
          "Count": "133"
        },
        {
          "Date": "2015-08-27",
          "Count": "109"
        },
        {
          "Date": "2015-08-28",
          "Count": "89"
        },
        {
          "Date": "2015-08-29",
          "Count": "74"
        },
        {
          "Date": "2015-08-30",
          "Count": "92"
        },
        {
          "Date": "2015-08-31",
          "Count": "139"
        },
        {
          "Date": "2015-09-01",
          "Count": "94"
        },
        {
          "Date": "2015-09-02",
          "Count": "115"
        },
        {
          "Date": "2015-09-03",
          "Count": "110"
        },
        {
          "Date": "2015-09-04",
          "Count": "115"
        },
        {
          "Date": "2015-09-05",
          "Count": "78"
        },
        {
          "Date": "2015-09-06",
          "Count": "87"
        },
        {
          "Date": "2015-09-07",
          "Count": "117"
        },
        {
          "Date": "2015-09-08",
          "Count": "124"
        },
        {
          "Date": "2015-09-09",
          "Count": "94"
        },
        {
          "Date": "2015-09-10",
          "Count": "108"
        },
        {
          "Date": "2015-09-11",
          "Count": "119"
        },
        {
          "Date": "2015-09-12",
          "Count": "89"
        },
        {
          "Date": "2015-09-13",
          "Count": "73"
        },
        {
          "Date": "2015-09-14",
          "Count": "151"
        },
        {
          "Date": "2015-09-15",
          "Count": "116"
        },
        {
          "Date": "2015-09-16",
          "Count": "127"
        },
        {
          "Date": "2015-09-17",
          "Count": "90"
        },
        {
          "Date": "2015-09-18",
          "Count": "120"
        },
        {
          "Date": "2015-09-19",
          "Count": "89"
        },
        {
          "Date": "2015-09-20",
          "Count": "100"
        },
        {
          "Date": "2015-09-21",
          "Count": "135"
        },
        {
          "Date": "2015-09-22",
          "Count": "97"
        },
        {
          "Date": "2015-09-23",
          "Count": "104"
        },
        {
          "Date": "2015-09-24",
          "Count": "105"
        },
        {
          "Date": "2015-09-25",
          "Count": "98"
        },
        {
          "Date": "2015-09-26",
          "Count": "69"
        },
        {
          "Date": "2015-09-27",
          "Count": "93"
        },
        {
          "Date": "2015-09-28",
          "Count": "117"
        },
        {
          "Date": "2015-09-29",
          "Count": "126"
        },
        {
          "Date": "2015-09-30",
          "Count": "106"
        },
        {
          "Date": "2015-10-01",
          "Count": "94"
        },
        {
          "Date": "2015-10-02",
          "Count": "118"
        },
        {
          "Date": "2015-10-03",
          "Count": "77"
        },
        {
          "Date": "2015-10-04",
          "Count": "66"
        },
        {
          "Date": "2015-10-05",
          "Count": "129"
        },
        {
          "Date": "2015-10-06",
          "Count": "119"
        },
        {
          "Date": "2015-10-07",
          "Count": "119"
        },
        {
          "Date": "2015-10-08",
          "Count": "103"
        },
        {
          "Date": "2015-10-09",
          "Count": "109"
        },
        {
          "Date": "2015-10-10",
          "Count": "86"
        },
        {
          "Date": "2015-10-11",
          "Count": "87"
        },
        {
          "Date": "2015-10-12",
          "Count": "131"
        },
        {
          "Date": "2015-10-13",
          "Count": "113"
        },
        {
          "Date": "2015-10-14",
          "Count": "103"
        },
        {
          "Date": "2015-10-15",
          "Count": "104"
        },
        {
          "Date": "2015-10-16",
          "Count": "82"
        },
        {
          "Date": "2015-10-17",
          "Count": "58"
        },
        {
          "Date": "2015-10-18",
          "Count": "88"
        },
        {
          "Date": "2015-10-19",
          "Count": "128"
        },
        {
          "Date": "2015-10-20",
          "Count": "98"
        },
        {
          "Date": "2015-10-21",
          "Count": "110"
        },
        {
          "Date": "2015-10-22",
          "Count": "95"
        },
        {
          "Date": "2015-10-23",
          "Count": "126"
        },
        {
          "Date": "2015-10-24",
          "Count": "55"
        },
        {
          "Date": "2015-10-25",
          "Count": "76"
        },
        {
          "Date": "2015-10-26",
          "Count": "121"
        },
        {
          "Date": "2015-10-27",
          "Count": "104"
        },
        {
          "Date": "2015-10-28",
          "Count": "115"
        },
        {
          "Date": "2015-10-29",
          "Count": "92"
        },
        {
          "Date": "2015-10-30",
          "Count": "90"
        },
        {
          "Date": "2015-10-31",
          "Count": "84"
        },
        {
          "Date": "2015-11-01",
          "Count": "110"
        },
        {
          "Date": "2015-11-02",
          "Count": "120"
        },
        {
          "Date": "2015-11-03",
          "Count": "130"
        },
        {
          "Date": "2015-11-04",
          "Count": "130"
        },
        {
          "Date": "2015-11-05",
          "Count": "99"
        },
        {
          "Date": "2015-11-06",
          "Count": "114"
        },
        {
          "Date": "2015-11-07",
          "Count": "81"
        },
        {
          "Date": "2015-11-08",
          "Count": "62"
        },
        {
          "Date": "2015-11-09",
          "Count": "136"
        },
        {
          "Date": "2015-11-10",
          "Count": "139"
        },
        {
          "Date": "2015-11-11",
          "Count": "125"
        },
        {
          "Date": "2015-11-12",
          "Count": "116"
        },
        {
          "Date": "2015-11-13",
          "Count": "108"
        },
        {
          "Date": "2015-11-14",
          "Count": "87"
        },
        {
          "Date": "2015-11-15",
          "Count": "68"
        },
        {
          "Date": "2015-11-16",
          "Count": "128"
        },
        {
          "Date": "2015-11-17",
          "Count": "127"
        },
        {
          "Date": "2015-11-18",
          "Count": "108"
        },
        {
          "Date": "2015-11-19",
          "Count": "100"
        },
        {
          "Date": "2015-11-20",
          "Count": "99"
        },
        {
          "Date": "2015-11-21",
          "Count": "106"
        },
        {
          "Date": "2015-11-22",
          "Count": "81"
        },
        {
          "Date": "2015-11-23",
          "Count": "134"
        },
        {
          "Date": "2015-11-24",
          "Count": "124"
        },
        {
          "Date": "2015-11-25",
          "Count": "111"
        },
        {
          "Date": "2015-11-26",
          "Count": "60"
        },
        {
          "Date": "2015-11-27",
          "Count": "91"
        },
        {
          "Date": "2015-11-28",
          "Count": "86"
        },
        {
          "Date": "2015-11-29",
          "Count": "75"
        },
        {
          "Date": "2015-11-30",
          "Count": "113"
        },
        {
          "Date": "2015-12-01",
          "Count": "97"
        },
        {
          "Date": "2015-12-02",
          "Count": "111"
        },
        {
          "Date": "2015-12-03",
          "Count": "93"
        },
        {
          "Date": "2015-12-04",
          "Count": "87"
        },
        {
          "Date": "2015-12-05",
          "Count": "75"
        },
        {
          "Date": "2015-12-06",
          "Count": "81"
        },
        {
          "Date": "2015-12-07",
          "Count": "139"
        },
        {
          "Date": "2015-12-08",
          "Count": "132"
        },
        {
          "Date": "2015-12-09",
          "Count": "119"
        },
        {
          "Date": "2015-12-10",
          "Count": "132"
        },
        {
          "Date": "2015-12-11",
          "Count": "129"
        },
        {
          "Date": "2015-12-12",
          "Count": "111"
        },
        {
          "Date": "2015-12-13",
          "Count": "112"
        },
        {
          "Date": "2015-12-14",
          "Count": "138"
        },
        {
          "Date": "2015-12-15",
          "Count": "113"
        },
        {
          "Date": "2015-12-16",
          "Count": "129"
        },
        {
          "Date": "2015-12-17",
          "Count": "116"
        },
        {
          "Date": "2015-12-18",
          "Count": "97"
        },
        {
          "Date": "2015-12-19",
          "Count": "88"
        },
        {
          "Date": "2015-12-20",
          "Count": "92"
        },
        {
          "Date": "2015-12-21",
          "Count": "153"
        },
        {
          "Date": "2015-12-22",
          "Count": "122"
        },
        {
          "Date": "2015-12-23",
          "Count": "111"
        },
        {
          "Date": "2015-12-24",
          "Count": "98"
        },
        {
          "Date": "2015-12-25",
          "Count": "55"
        },
        {
          "Date": "2015-12-26",
          "Count": "70"
        },
        {
          "Date": "2015-12-27",
          "Count": "74"
        },
        {
          "Date": "2015-12-28",
          "Count": "114"
        },
        {
          "Date": "2015-12-29",
          "Count": "131"
        },
        {
          "Date": "2015-12-30",
          "Count": "101"
        },
        {
          "Date": "2015-12-31",
          "Count": "99"
        }
      ];

      sample.sort((a, b) => new Date(a.Date) - new Date(b.Date));

      const dateValues = sample.map(dv => ({
        date: d3.timeDay(new Date(dv.Date)),
        value: Number(dv.Count)
      }));

      const svg = d3.select("#svg");
      const { width, height } = document
        .getElementById("svg")
        .getBoundingClientRect();


      function draw() {
        const years = d3
          .nest()
          .key(d => d.date.getUTCFullYear())
          .entries(dateValues)
          .reverse();

        const values = dateValues.map(c => c.value);
        const maxValue = d3.max(values);
        const minValue = d3.min(values);

        const cellSize = 15;
        const yearHeight = cellSize * 7;

        const group = svg.append("g");

        const year = group
          .selectAll("g")
          .data(years)
          .join("g")
          .attr(
            "transform",
            (d, i) => `translate(50, ${yearHeight * i + cellSize * 1.5})`
          );

        year
          .append("text")
          .attr("x", -5)
          .attr("y", -30)
          .attr("text-anchor", "end")
          .attr("font-size", 16)
          .attr("font-weight", 550)
          .attr("transform", "rotate(270)")
          .text(d => d.key);

        const formatDay = d =>
          ["Mo", "Tu", "We", "Th", "Fr", "Sa", "Su"][d.getUTCDay()];
        const formatMonth = d =>
          ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"][d.getUTCMonth()];
        const countDay = d => d.getUTCDay();
        const countMon = d => d.getUTCMonth();
        const timeWeek = d3.utcSunday;
        const formatDate = d3.utcFormat("%x");
        const colorFn = d3
          .scaleSequential(d3.interpolateBuGn)
          .domain([Math.floor(minValue), Math.ceil(maxValue)]);
        // const format = d3.format("+.2%");

        year
          .append("g")
          .attr("text-anchor", "end")
          .selectAll("text")
          .data(d3.range(7).map(i => new Date(1995, 0, i)))
          .join("text")
          .attr("x", -5)
          .attr("y", d => (countDay(d) + 0.5) * cellSize)
          .attr("dy", "0.31em")
          .attr("font-size", 12)
          .text(formatDay);

        year
          .append("g")
          .selectAll("rect")
          .data(d => d.values)
          .join("rect")
          .attr("width", cellSize - 1.5)
          .attr("height", cellSize - 1.5)
          .attr("x", (d, i) => timeWeek.count(d3.utcYear(d.date), d.date) * cellSize + 10)
          .attr("y", d => countDay(d.date) * cellSize + 0.5)
          .attr("fill", d => colorFn(d.value))
          .append("title")
          .text(d => `${formatDate(d.date)}: ${d.value.toFixed(2)}`)

        const legend = group
          .append("g")
          .attr(
            "transform",
            `translate(60, ${years.length * yearHeight + cellSize * 4})`
          );

        const categoriesCount = 5;
        const categories = [...Array(categoriesCount)].map((_, i) => {
          const upperBound = (maxValue / categoriesCount) * (i + 1);
          const lowerBound = (maxValue / categoriesCount) * i;

          return {
            upperBound,
            lowerBound,
            color: d3.interpolateBuGn(upperBound / maxValue),
            selected: true
          };
        });

        const legendWidth = 60;

        function toggle(legend) {
          const { lowerBound, upperBound, selected } = legend;

          legend.selected = !selected;

          const highlightedDates = years.map(y => ({
            key: y.key,
            values: y.values.filter(
              v => v.value > lowerBound && v.value <= upperBound
            )
          }));

          year
            .data(highlightedDates)
            .selectAll("rect")
            .data(d => d.values, d => d.date)
            .transition()
            .duration(500)
            .attr("fill", d => (legend.selected ? colorFn(d.value) : "white"));
        }

        legend
          .selectAll("rect")
          .data(categories)
          .enter()
          .append("rect")
          .attr("fill", d => d.color)
          .attr("x", (d, i) => legendWidth * i)
          .attr("width", legendWidth)
          .attr("height", 15)
          .on("click", toggle);

        legend
          .selectAll("text")
          .data(categories)
          .join("text")
          .attr("transform", "rotate(90)")
          .attr("y", (d, i) => -legendWidth * i)
          .attr("dy", -30)
          .attr("x", 18)
          .attr("text-anchor", "start")
          .attr("font-size", 11)     
          .text(d => `${d.lowerBound} - ${d.upperBound}`);

        legend
          .append("text")
          .attr("dy", -5)
          .attr("font-size", 14)
          .attr("text-decoration", "underline")
          .text("Click on category to select/deselect days");
      }

      draw();
    </script>
  </body>
</html>
